# 动画

## 方式

### js 设置定时器

####  

#### 使用setTimeout设置动画不够精准，会发生丢帧的情
况setTimeout(callback,1/60)。因为各浏览器实现的
定时器更新频率不同。ie8及之前版本，更新时间为15.6ms,
setTimeout 16.7ms，那么就需要2个15.6ms才能完成
动画

### css3 animation、transition、transform

### js canvas、webgl、svg

### requestAnimationFrame

#### requestAnimationFrame(callback)。自动调节频率。
如果callback在一帧内无法完成太多工作，函数会自动
降低刷新频率30FPS

### GPU 硬件加速

### Flash

## 浏览器渲染小结

### 渲染三个阶段：Layout 、Paint、Composite Layers

### 修改不同的css属性会触发不同的阶段

网址https://csstriggers.com/ 查看修改css属性会分别触发拿一个阶段

### 触发的阶段越靠前，渲染的代价就越大

因为浏览器的渲染是按照Layout、Paint、Composite Layers的顺序进行的，如果触发了Layout就会一次向下触发

## 硬件加速(GPU加速)

### CPU、GPU异同点

#### 相同：两者都有总线和外界联系，有自己的缓存体系，
以及数字和逻辑运算单元。两者都是为了完成计算任务
而设计的

#### 不同：CPU主要负责操作系统和应用程序,GPU主要负
责跟显示相关的数据处理。GPU的活CPU都能干，只是
效率比较低

### CPU 中央处理器

#### CPU的计算单元少，但是计算能力强，
CPU处理一些计算逻辑比较复杂的东西

### GPU 图形处理器

#### GPU的计算单元多，但是计算能力弱，GPU计算单元
多主要处理一些吞吐量大的任务

### Layer(图层)创建标准

#### 拥有3d transform属性

#### 使用animation、transition实现opacity,transform的动画

#### video

#### canvas

#### Flash

#### 使用css filters的元素

#### z-index大于某个相邻节点的layer元素

### 为什么使用硬件加速动画性能比较好

#### 普通动画：比如修改一个元素的top值从100px，变到200px。
会先从top:100px->top：101px然后将位图传
入到GPU，top:101px->top:102px在传入GPU,一直
到top:200px。并且会重复Layout->Paint->Composite
 Layers这一过程

#### 硬件加速动画：会直接在GPU进行从top:100px->top:
200px这一过程,只进行了Composite Layers这一阶段，

#### 硬件加速动画比普通动画节省时间的地方

##### 1. 省去了Layout->Paint->Composite Layers这一阶段

##### 2. 省去了CPU想GPU传送位图的过程

## 重绘、重排(repaint、reflow)

### 重绘repaint

重新生成DOM树和渲染树CSSOM。DOM树表示页面结构，渲染树表示页面如何显示

#### 产生

##### 修改元素的样式等

### 重排reflow

当元素的外观发生变化时触发

#### 产生

##### 页面渲染初始化(无法避免)

##### 浏览器窗口大小改变

##### 元素尺寸、内容、位置发生改变

##### 添加、删除可见DOM节点

##### 获取某些属性引发重排

###### offseTop/Left/Width/Height

###### scrollTop/Left/Width/Height

###### clientTop/Left/Width/Height

###### 调用getComputedStyle()、IE的currentStyle

#### 优化

##### 将多次改变样式属性的操作合并成一个

##### 需要添加DOM时，先让元素脱离文档流，操作后再加入文档流

###### 先将节点display:none,当操作完成后再添加到节点上，这样就只触发了2次重排

###### 在添加DOM节点时，通过创建一个文本节点，将要添
加的节点插入到文本节点中，完成后再插入DOM树中
createDocumentFragment()

##### 将不需要的节点设置为display:none。这样DOM节点中就不存在该节点，就不会对该节点进行重排

## Composite Layers GPU中合成层

### GPU也是有限度的，不要滥用GPU资源生成不必要的Layer

### 留意额外生成的layer
