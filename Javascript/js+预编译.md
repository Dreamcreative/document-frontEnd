# js 预编译

## js 在预编译时

### 会生成一个执行环境栈（Excution Context Stack）

，全局对象(GO)（包含 Math、String、Date、document 等对象作为其属性）
同时会创建一个全局执行环境（EC）(Excution Context) 。同时还会创建一个与 EC 关联的 VO(variable Object)变量对象

## 当第一次执行函数 foo 时

### 会为函数创建一个 AO（Activation Object）活动对象

并为函数 foo 添加一个[scope]属性执行 VO。
每个函数创建时都会创建一个与之关联的[scope]属性，
[scope]属性总是指向定义函数时所在的环境

## 当 foo 执行完成之后

### 函数 foo 的 AO 会从执行环境栈中弹出。

如果还有其他函数需要执行时，会将其他函数的 AO 压入到执行环境栈中

## VO AO

### VO 变量对象 AO 活动对象，其实是同一个东西，

只是处于 js 编译时的不同生命周期时的叫法

### 函数的 VO 包含了 this、arguments、内部声明的函数、变量等内容

## 作用域链（scope chain）

### 其实就是在创建函数时，js 为这个函数创建的[scope]属性。

[scope]属性包含了当前函数执行时的一整个执行环境。
在函数内部进行变量查找时，首先会在当前自己的 VO 中查找，
如果没有找到，就会向[scope]属性中存储的上一个
 VO 中查找，一直查找到最上层的 GO（全局对象）

## 闭包

### 能够访问函数外部的变量

#### 由于函数在定义的过程中 js 为其添加了一个[scope]属性

当外层函数执行完成之后，被回收，但是由于闭包会返回一个函数，
使得返回的函数仍然保留了父级函数的作用域链，
所以能够继续访问到已经被销毁的变量以及函数

### 作用

### 优缺点

#### 优点

##### 私有化变量

##### 避免全局污染

##### 变量长期储存在内存中

#### 缺点

##### 造成内存泄露
