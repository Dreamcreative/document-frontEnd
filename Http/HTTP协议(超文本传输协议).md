# HTTP1.x、HTTP2.0、 HTTP3 协议(超文本传输协议)

## HTTP2

### HTTP2 与 HTTP1.x的区别

	1. HTTP2 相对于 HTTP1.x 语义没有变化
	2. HTTP2 引入了二进制分帧层，无法与 HTTP1.x 进行兼容，所以将版本切换到 HTTP2
	3. HTTP2 使用了二进制进行数据传输，使得内容更加紧凑，具有天然的数据加密

### HTTP2 的特点

	1. 使用二进制分帧层进行数据传输，更高效，更紧凑，天然的数据加密
	2. 服务端推送，服务器主动推送，减少请求的延迟，解决了 HTTP1.x 存在的队首阻塞问题
	3. 多路复用，一个网络连接，实现并行请求
	4. 对报文进行压缩，降低了数据传输的开销，HTTP1.x 只对请求体进行压缩

### 请求方式的改变

	1. HTTP1.x: 先请求页面骨架，请求完毕后，再请求页面所使用到的资源
	2. HTTP2: 使用服务器推送，当客户端请求页面骨架时，服务器会主动对页面使用到的资源进行分析，同时将页面主体与页面所使用到的资源一并发送给客户端，减少了建立的请求连接数

### 伪头字段

> HTTP2 内置了几个特殊的 key，以`:`开头
	
	1. :method: 目标 url 部分
	2. :scheme: http 协议版本
	3. :authority: 请求的主机地址
	4. :path: 请求的地址部分
	5. :status: 响应头中的 http 状态码

```
:method: POST
:scheme: http/1.1
:authority: www.baidu.com
:path: ?id=xxx
:status: 200
```
## HTTP2 的缺点

1. 解决了 HTTP1 的队首阻塞问题，但是 HTTP2 自身还是存在队首阻塞问题。当数据拆分成一个个小的数据包发送，当其中一个数据包丢失后，会导致后面的数据包等待确认
2. TCP 和 TCP+TLS 连接超时
3. 多路复用导致请求超时
4. 多路复用导致服务器压力上升

## HTTP3(QUIC)

### 特点

	1. HTTP3 采用 UDP 协议进行数据传输，HTTP2/HTTP1.x 使用 TCP 协议进行数据传输，但是由于 TCP 协议的验证太多，使得传输效率不高
	2. HTTP3 采用 UDP 协议，减少了握手延迟
	3. HTTP3 进一步解决了 HTTP2 的队首阻塞问题

## 队首阻塞问题

	1. HTTP2.0 解决了 HTTP1.x的队首阻塞问题，但是由于 HTTP2.0 使用 TCP 协议，HTTP2.0 也具有队首阻塞问题(`数据传输层面`)
	2. HTTP2.0 解决了 HTTP 级别的 `队首阻塞问题`
	3. HTTP2.0 采用多路复用来解决 HTTP1.x 存在的队首阻塞问题，是将资源拆分成多个小的数据包同时按顺序发送，然后在客户端进行组装。小的数据包会带有它之前数据包的识别信息，如果数据包1、数据包3 发送成功，但是数据包2 发送失败，客户端会将数据包1 储存在缓存区，而数据包3 虽然也发送成功了，但是由于缺少了数据包2，所有数据包3 不会被客户端进行存储。只有当服务器再次将数据包2 发送过来后，客户端才会将数据包2、数据包3传递给浏览器。这里就是在数据传输过程中，由于其中一个数据包传输错误，从而导致该数据包之后的数据包被阻塞。这是数据传输层的 `队首阻塞问题`
	4. HTTP3 解决了 数据传输层面的 `队首阻塞问题`
	5. HTTP3 解决 `队首阻塞问题` 的方式：数据包1、数据包2、数据包3。如果数据包1、3 都到达客户端，数据包2 丢失，HTTP3 会先将数据包1、3 交给浏览器先处理，等到服务器将丢失的数据包2 再次发送过来之后，再将数据包2 交给浏览器

## 参考

* [HTTP 队首阻塞](https://zhuanlan.zhihu.com/p/330300133)
* [HTTP2、HTTP3优缺点整理](https://juejin.cn/post/6923096773423153159)
