# Vapor模式

Vue3 Vapor 模式是Vue 官方正在探索的一种实验性渲染模式，目标是实现`无虚拟DOM`的极简、高性能渲染方式。它希望通过直接操作真实DOM,避免创建虚拟节点以及运行时的`虚拟DOM diff` 过程，从而获得更接近原生 JavaScript 操作 DOM 的性能表现

## 核心目标

1. 去除虚拟 DOM 
2. 直接生成真实 DOM 操作代码
3. 更小的运行时体积
4. 更快的渲染与更新性能

## Vapor 是如何工作的

与传统的 template-> vnode-> DOM diff -> render 的渲染流程不同。Vapor 模式尝试在编译阶段就分析出 UI 依赖关系，然后直接生成操作真实 DOM 的代码，从而

1. 不生成 Vnode
2. 不进行 DOM diff
3. 直接精准更新需要的 DOM 元素

## Vue3 如何优化虚拟DOM,使其更高效

1. 编译时优化

* Vue3 引入了强大的模板编译器优化，尤其针对静态内容与动态内容的区分，大大减少了运行时不必要的`虚拟DOM diff`
  1. 静态提升
      1. 模板中的静态节点在编译阶段就被提升出来，只创建一次，之后直接复用，不再参与 diff
  2. 补丁标记
     1. Vue3 在编译阶段，会分析每一个动态绑定的部分`{{msg}`、`v-bind`、`v-if` 等，并打上最小粒度的补丁标记。这样使得在内容变更之后，只比对变更内容，而不必对整颗节点树做比对，大幅减少了 DOM diff 的开销
  3. 树结构优化
     1. Vue3 将模板中动态的部分组织成一个块，只追踪这些块内的动态节点
     2. 静态节点被完全跳过，不参与后续的 DOM diff,减少渲染开销
  4. vue3 支持 tree-shaking
     1. Vue3 的虚拟 DOM 相关代码支持 `tree-shaking`,只打包实际用到的功能。减少包体积，间接提升运行效率
