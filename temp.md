# HTTP 协议(超文本传输协议)

## HTTP2

### http2 与 http/1.\* 区别

1. http2 对 http/1.\*的语义没有改变
2. http2 引入了二级制分帧层，无法与 http/1.\*进行兼容。因此将 http 版本切换到了 http2
3. http/1.\* 使用文本进行数据传输。http2 使用二进制进行数据传输，使得传输内容更加紧凑，具有天然的数据加密

### 特点

1. 使用二进制分帧层进行数据传输，更高效，更紧凑
2. 对报头进行压缩，降低数据传输的开销；http/1.\*只对请求体进行压缩
3. 多路复用，一个网络连接实现并行请求 4.服务器主动推送，减少请求的延迟，解决了 http/1.\*的队首阻塞问题
4. 默认使用加密传输

### 请求方式的改变

http/1.\* : 先请求页面骨架，只有当页面骨架请求完毕
之后，才会继续请求页面所用到的资源

http2 : 服务器主动推送，当客户端请求时，服务器会
主动分析页面骨架中使用到的资源，并同时将页面骨架
与页面所用到的资源推送给客户端，减少建立连接的数量

### 伪头字段

http2 内置了几个特殊的以 ":"开头的 key
:method ： 目标 URL 部分
:scheme : 请求的 http 协议版本
:authority: 请求的主机地址
:path : 请求的地址部分
:status : 响应头中的 http 状态码

:method    :path        :authority
GET       /index/index     http/1.1
Host: www.baidu.com
 :scheme

## 当我们输入网址之后发生了什么

### 1，输入网址并回车 2. 解析域名 3.浏览器发送请求 4，

服务器处理请求 5. 服务器返回 html 响应 6. 浏览器处理
HTML 页面 7.继续请求其他资源

### 1，跨越内外网，说明网是通的

2， 解析域名：向 DNS 服务器请求，并解析域名，最后
找到相对应的 IP 地址
3，向 IP 地址发送请求
4，服务器处理请求
5，服务器返回响应
6，浏览器接受到响应内容后，进行解析
7，继续请求其他资源

## HTTP 分层

### 应用层

#### 应用层

#### 表示层

#### 会话层

#### 协议：HTTP、DNS、FTP

### 传输层

#### 协议：TCP/UDP

##### TCP：传输控制协议，稳定的协议，无论成功或失败都会返回

##### UDP：不靠谱协议，(你只是将事情交代下去了 ，但是

事情的完成情况你并不清楚)。但是可以通过顶层设计
使得 UDP 协议变成一种靠谱的协议，HTTP3 就是通过 U
DP 协议来进行数据传输的

### 网络层

#### 协议：IP

### 网络接口层

#### 数据链路层

#### 物理层

## HTTP 工作流程

### 一次 HTTP 操作就是一个事务，串行操作，要么所有事情都成功，要么就失败

1. 客户端与服务器建立连接
2. 建立连接后，客户端向服务器发送请求
3. 服务器收到请求后，返回响应
4. 客户端收到响应后，通过浏览器进行解析渲染，并与服务器断开连接

## HTTP 请求与响应

### 请求组成：请求行 、消息报头、请求正文

请求行：请求方法、URI、HTTP 协议版本
         POST 、/index/index 、 http/1.1

### 响应组成：响应行、消息报头、响应体

响应行：服务器协议、状态码、状态描述
         HTTP/1.1、 200 、 OK

### 通用报头字段

#### Cache-Control: 控制缓存的行为

Date: 创建报头的时间
Upgrade: 升级为其他协议
Via: 代理服务器的相关信息

### 请求报头字段名

#### Accept: 客户端可处理的媒体类型

Accept-Charset:客户端使用的字符集
Accept-Language: 客户端使用的语言
Expect: 期待服务器的特定行为
Host: 请求资源所在的服务器
If-Modified-Since: 比较资源的过期时间(第二次请求之后)
If-None-Match: 比较资源的 Etag 标签(第二次请求之后)
Referer: 页面的来源地址
User-Agent: 客户端信息

### 响应报头字段名

#### Accept-Ranges: 是否接受字节范围请求

Age: 推算资源创建经过的时间
Etag: 资源的标签
Server: 服务器信息
Vary: 服务器缓存的管理信息
Connect-Type: 连接方式
Content-Encoding: 服务器支持的压缩格式
Content-Type: 服务器返回的资源格式
Set-Cookie： 服务器在浏览器设置 cookie 信息
Last-Modify: 资源最后一次更新时间
Expires: 资源过期时间

## http 握手协议

### 建立连接（握手）

#### 1.客户端发送建立连接请求

#### 2.服务器收到连接请求后，向客户端返回连接响应，同时向客户端发起连接请求

#### 3.客户端应答服务器连接客户端的指令

### 断开连接（挥手）

#### 1，客户端主动发起断开连接的请求

#### 2. 服务器响应客户端的断开连接请求

#### 3.服务器将服务器断开连接的指令发送给客户端

#### 4.客户端应答服务器的断开连接指令

### 握手三次挥手四次的原因

#### 在握手时，服务器没有在响应客户端的断开连接请求时

同时向客户端发送断开连接指令，是因为此时，服务器
端还要将正在处理的工作结束掉，当工作结束之后，才
向客户端发送断开连接的指令

### 半连接状态

#### 1，握手时

##### 客户端没有响应服务器端的连接指令

#### 2.挥手时

##### 客户端没有响应服务器端的挥手指令

#### 造成的问题

##### tcp 的半连接状态使得服务器的资源无法释放。会造成 DOS 和 DDOS 攻击

#### DOS 和 DDOS 攻击

##### 拒绝服务攻击和分布式拒绝服务攻击

###### 内存消耗型

###### 带宽占用型

##### 同时向服务器发送大量的半连接请求，由于服务器建立

连接需要消耗服务器资源，而半连接的状态使得服务器
没法对该请求进行释放，使得服务器被大量消耗

## Cookie、session

### 作用： 最基本的作用就是维持会话，识别客户端身份。

由于 HTTP 是一种无状态协议，无法维持会话状态。每
次断开连接之后，当下次再连接时，服务器无法在识别
客户端身份

### cookie: 是保存在客户端的一小段文本，大小为 4k,一般

由服务器下发，随着客户端的每次请求，该 URL 下的所
有 cookie 都将发送到服务器

### session: 是保存在服务器，通过一个唯一值 sessionID

来区分每一个用户，在服务器会有一个小型数据库来维
护 session. sessionID 随每个请求发送到服务器，服务
器根据这个 sessionID 来识别每一个用户

## HTTP 缓存机制(目的：提高访问速度，减少服务器压力)

### 浏览器请求时，缓存的使用过程

### 强缓存：服务器通知客户端一个缓存时间，在缓存时间

内，下次请求，直接使用缓存，否则使用协商缓存

#### 优先级高

Cache-Control: http/1.1 字段，
no-cache: 直接进行协商缓存
no-store: 客户端不进行缓存
public: 表示响应可以被任何对象缓存(客户端、代理服务器等等)
private: 表示响应只能被客户端缓存，代理服务器不能缓存
max-age=<seconds> : 设置缓存的最大周期，超过则资源过期，需要重新请求。是一个相对时间
等等....

#### 优先级低

Expires: http/1.0 字段 ，是一个绝对时间

### 协商缓存：通过 Etag、Last-Modified 与服务器进行比

对，如果比对成功，则服务器返回 304 使用缓存；否则
返回 200 使用服务器返回的资源

#### 优先级高

Etag/If-None-Match: 服务器为资源生成一个唯一标
识，Etag 由服务器发送给客户端，当客户端请求时，客
户端使用 If-None-Match 字段将唯一标识发送到服务
器，服务器进行比对，如果比对成功，则返回 304，表
示资源未发生改变，直接使用缓存；否则返回 200，使
用返回的新的资源
由于 Last-Modify 只能响应到秒级的资源更新，毫秒级
的更新无法被察觉，所以在 HTTP1.1 新增了
Etag/if-none-Match 来响应资源毫秒级的更新

#### 优先级低

Last-Modify/If-Modified-Since 只能响应到资源秒级的更新
Last-Modify/If-Modified-Since: 服务器通过 Last-Modify
字段发送一个资源的过期时间给客户端，客户端在下次
请求时使用 If-Modified-Since 字段将这个值发送给服
务器，服务器比对，如果比对成功，则返回 304，表示
资源未发生改变，直接使用缓存；否则返回 200，使用
返回的新的资源。

## 协议

### SSL/TLS 协议：

Secure Socket Layer / Translate Layer Security (安全套接层 / 传输层安全协议)

#### TLS 有四个子协议：握手协议、秘钥切换协议、应用数据协议、报警协议

### HTTPS 协议分析

#### 简述

##### HTTPS 采用对称加密和非对称加密结合的方式来保护浏览器和服务器之间的通信安全。

对称加密加密数据 + 非对称加密交换秘钥 + 数字证书验证身份

##### HTTPS 由两部分组成 ： HTTP+SSL/TLS 。就是在 HTTP 上又加了一层处理加密信息的模块

#### 1. 客户端主动发起连接请求

2. 服务器收到请求后，响应客户端
3. \*\* 服务器端发送服务器端证书给客户端
4. \*\* 如果是双向验证，服务器向客户端请求客户端证书 5.服务器通知客户端初始协商结束
5. \*\* 如果是双向验证，客户端向服务器发送客户端证书
6. 客户端使用服务器的公钥，对客户端公钥和秘钥种子进行加密，发送给服务器
7. \*\* 如果是双向验证，客户端用本地私钥生成数字签名，发送给服务器，
8. 通讯双方基于秘钥种子等信息生产通讯秘钥
9. 客户端通知服务器已将通讯方式切换到加密模式 11.客户端做好加密通讯的准备
10. 服务器通知客户端已将通讯方式切换到加密模式
11. 服务器做好加密通讯的准备
12. 双方使用客户端秘钥，通过对称加密算法对通讯内容进行加密
13. 通讯结束，任何一方发起断开连接消息

1-13 ：握手过程 。 14-15 ：通信过程

#### https 握手协议

##### 1. 客户端发送握手请求（包含版本信息、加密-套件、压缩算法、随机数）

##### 2. 在采用 HTTPS 协议的服务器必须要有一套数字证书（自己制作或者是向组织申请）就是一对公钥和私钥

##### 3. 服务器返回协商信息结果（包含选择使用的版本、选择的加密套件、选择的压缩算法和随机数、以及证书 等等）

##### 4. 客户端验证证书的合法性（包括可信度、证书是否可用）。如果证书（公钥）没有问题，则对随机数进行加密

##### 5. 客户端使用公钥对对称秘钥进行加密，发送给服务器

##### 6. 服务器用私钥解密，拿到对称加密的秘钥

##### 7. 传输加密后的信息，（在客户端可以用随机数解密还原）

##### 8. 客户端解密信息

##### 9. 断开连接

## HTTP3 (QUIC)

### 特点；

1. http3 使用 UDP 协议传输数据，虽然 TCP 协议安全，但是由于验证太多，导致传输效率不高
2. http3 由于使用 UDP 协议，减少了握手延迟
3. http3 没有网络切换的影响

### 队首阻塞问题

http2 解决了 http/1.\*的队首阻塞问题，但是由于 http2
使用 TCP 协议，http2 也具有队首阻塞的问题

http2 采用多路复用，来解决 http/1.\*的队首阻塞问题
时，是将资源拆分成多个小的数据包同时发送，然后在
客户端再进行组装。当其中某个数据包丢失数据时，需
要重新发送

http3 完美解决了队首阻塞问题，由于使用 UDP 协议，
使用的是无序传输，当某个 UDP 包传输失败，只要重传
这个数据包就可以了

## HTTP 常用状态码

### 1\*\* ： 通知

#### 100: Continue （继续） 服务端接收到请求，并且客户端应该继续发送请求

#### 101: Switching Protocols （交换协议）服务器接收到请求，会切换客户端 Upgrade 的协议

#### 102: Processing （进行中）服务器已经接收到请求，但是没有响应返回

### 2\*\* ： 成功

#### 200 OK （请求成功） 成功请求并返回响应

#### 201 Created （请求已被实现） 一个新的资源已被创建

#### 202 Accept （已接收请求） 服务器已接收请求，但是尚未处理

#### 204 No Content （无响应内容） 服务器已成功处理请求，但是没有返回内容

#### 205 Reset Content （重置文档）服务器已成功处理请求，但是没有返回内容（与 204 不同，此响应需要重置文档）

### 3\*\* ： 重定向

#### 301 Moved Permanently （永久移动到新位置）

#### 302 Found （临时重定向 Moved Temporarily）

#### 303 See Other （资源被找到，但是需要请求重定向）

#### 304 Not Modified （资源未变更,使用缓存）

#### 305 Use Proxy （资源需要使用代理才能被访问）

### 4\*\* ： 客户端错误

#### 400 Bad Request （错误的请求）

#### 401 Unauthorized （未经授权的请求）

#### 403 Forbidden （服务器禁止访问）

#### 404 Not Found （请求失败）

#### 405 Method Not Allowed （方法不被允许）

#### 406 Not Acceptable （请求不可接受）

#### 408 Request Timeout （请求超时）

### 5\*\* ： 服务器错误

#### 500 Internal Server Error （服务器报错）

#### 501 Not Implemented （此方法无法被服务器支持,且无法被处理）

#### 502 Bad Gateway （错误的网关）

#### 503 Service Unavailable （服务器不可用） 由于服务器维护或过载，暂时无法处理请求

#### 504 Gateway Timeout （网关请求超时）

#### 505 HTTP Version Not Supported （http 版本不支持）
